<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ÙØ±Ù‚</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f4f4f4;
    }
    h2 {
      color: #333;
    }
    .team-card, .edit-request-card {
      border: 2px solid #ccc;
      border-radius: 8px;
      background-color: #fff;
      padding: 15px;
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin: 8px 0 4px;
    }
    input, select, textarea {
      width: 100%;
      max-width: 400px;
      padding: 6px;
      margin-bottom: 10px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    button {
      margin: 5px 5px 0 0;
      padding: 8px 12px;
      border: none;
      border-radius: 4px;
      background-color: #f1c40f;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover {
      background-color: #e67e22;
    }
    img {
      margin-top: 10px;
      max-width: 120px;
    }

    .team-card {
      background: white;
      border: 1px solid #ddd;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 8px;
    }
    .team-card input, .team-card select {
      width: 100%;
      margin-bottom: 8px;
      padding: 6px;
    }
    .team-card img {
      max-width: 80px;
      margin-bottom: 10px;
    }
    .buttons {
      display: flex;
      gap: 10px;
    }
  </style>
</head>
<body>
  <h2>ğŸ“ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ù…Ø±Ø³Ù„Ø©</h2>
  <div id="teamsList"></div>

  <h2>ğŸ“© Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ</h2>
  <div id="editRequestsList"></div>




  
  <h2>Ø¥Ø¯Ø§Ø±Ø© ÙƒÙ„ Ø§Ù„ÙØ±Ù‚</h2>
  <h3>ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙØ±Ù‚</h3>
  <input type="text" id="searchName" placeholder="ğŸ” Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚" oninput="fetchTeams()" />
  <select id="searchRegion" onchange="fetchTeams()">
    <option value="">ÙƒÙ„ Ø§Ù„Ø£Ù‚Ø§Ù„ÙŠÙ…</option>
    <option value="Ø§Ù„Ù†ÙŠÙ†Ø¬Ø§">Ø§Ù„Ù†ÙŠÙ†Ø¬Ø§</option>
    <option value="Ø§Ù„ÙØ§ÙŠÙƒÙŠÙ†Øº">Ø§Ù„ÙØ§ÙŠÙƒÙŠÙ†Øº</option>
    <option value="Ø§Ù„Ù‚Ø±Ø§ØµÙ†Ø©">Ø§Ù„Ù‚Ø±Ø§ØµÙ†Ø©</option>
    <option value="Ø¨Ù„ÙŠØªØ´">Ø¨Ù„ÙŠØªØ´</option>
    <option value="Ù†ÙˆÙØ§">Ù†ÙˆÙØ§</option>
    <option value="Ø§Ù„Ø¹Ù…Ø§Ù„Ù‚Ø©">Ø§Ù„Ø¹Ù…Ø§Ù„Ù‚Ø©</option>
    <option value="Ø§Ù„Ø£Ø¨Ø§Ø·Ø±Ø©">Ø§Ù„Ø£Ø¨Ø§Ø·Ø±Ø©</option>
    <option value="Ø§Ù„ÙØ±Ø§Ø¹Ù†Ø©">Ø§Ù„ÙØ±Ø§Ø¹Ù†Ø©</option>
    <option value="Ø§Ù„Ù…Ù…Ø§Ù„ÙŠÙƒ">Ø§Ù„Ù…Ù…Ø§Ù„ÙŠÙƒ</option>
    <option value="Ø§Ù„Ù…Ø§ÙÙŠØ§">Ø§Ù„Ù…Ø§ÙÙŠØ§</option>
    <!-- Ø£Ø¶Ù Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ù‚Ø§Ù„ÙŠÙ… Ù‡Ù†Ø§ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø© -->
  </select>
  <select id="searchRank" onchange="fetchTeams()">
    <option value="">ÙƒÙ„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</option>
    <option value="Ø°Ù‡Ø¨ÙŠ">Ø°Ù‡Ø¨ÙŠ</option>
    <option value="ÙØ¶ÙŠ">ÙØ¶ÙŠ</option>
    <option value="Ø¨Ø±ÙˆÙ†Ø²ÙŠ">Ø¨Ø±ÙˆÙ†Ø²ÙŠ</option>
    <option value="Ø¨Ø¯ÙˆÙ† ØªØµÙ†ÙŠÙ">Ø¨Ø¯ÙˆÙ† ØªØµÙ†ÙŠÙ</option>
  </select>
  <div id="teamsContainer"></div>



  <script>
const firebaseConfig = {
      apiKey: "AIzaSyD5h5LAp9bVY9Xrx0yF8PaXih4841vSgBQ",
      authDomain: "workermanager999.firebaseapp.com",
      databaseURL: "https://workermanager999-default-rtdb.firebaseio.com",
      projectId: "workermanager999",
      storageBucket: "workermanager999.appspot.com",
      messagingSenderId: "961550697494",
      appId: "1:961550697494:web:4339c2bfc5c874496de137",
      measurementId: "G-99GTSST8VT"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const teamsDiv = document.getElementById("teamsList");
    const requestsDiv = document.getElementById("editRequestsList");

    function calculateRank(points) {
      if (points >= 800) return "Ø°Ù‡Ø¨ÙŠ";
      else if (points >= 500) return "ÙØ¶ÙŠ";
      else if (points >= 250) return "Ø¨Ø±ÙˆÙ†Ø²ÙŠ";
      else return "Ø¨Ø¯ÙˆÙ† ØªØµÙ†ÙŠÙ";
    }

    function fetchTeams() {
  const container = document.getElementById("teamsContainer");
  const nameFilter = document.getElementById("searchName").value.toLowerCase();
  const regionFilter = document.getElementById("searchRegion").value;
  const rankFilter = document.getElementById("searchRank").value;

  container.innerHTML = "";
  db.ref("teams").once("value").then(snapshot => {
    snapshot.forEach(child => {
      const key = child.key;
      const data = child.val();

      // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ±
      const nameMatch = data.name?.toLowerCase().includes(nameFilter);
      const regionMatch = !regionFilter || data.region === regionFilter;
      const rankMatch = !rankFilter || data.rank === rankFilter;

      if (nameMatch && regionMatch && rankMatch) {
        const div = document.createElement("div");
        div.className = "team-card";
        div.innerHTML = `
          <strong>Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚:</strong>
          <input id="name-${key}" value="${data.name || ''}"> <br/>
          
          <strong>Ø±Ø§Ø¨Ø· Ø§Ù„Ø´Ø¹Ø§Ø±:</strong>
          <input id="logo-${key}" value="${data.logo || ''}"> <br/>

          <strong>Ø§Ù„Ø¥Ù‚Ù„ÙŠÙ…:</strong>
          <input id="region-${key}" value="${data.region || ''}"> <br/>

          <strong>Ø§Ù„Ù†Ù‚Ø§Ø·:</strong>
          <input type="number" id="points-${key}" value="${data.points || 0}"> <br/>

          <strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong>
          <select id="status-${key}">
            <option value="Ù…ÙØªÙˆØ­" ${data.status === "Ù…ÙØªÙˆØ­" ? "selected" : ""}>Ù…ÙØªÙˆØ­</option>
            <option value="Ù…ØºÙ„Ù‚" ${data.status === "Ù…ØºÙ„Ù‚" ? "selected" : ""}>Ù…ØºÙ„Ù‚</option>
          </select>  <br/>

          <img src="${data.logo}" alt="Ø´Ø¹Ø§Ø± Ø§Ù„ÙØ±ÙŠÙ‚"><br>
          <div class="buttons">
            <button onclick="saveTeam('${key}')">ğŸ’¾ Ø­ÙØ¸</button>
            <button onclick="deleteTeam('${key}')">ğŸ—‘ Ø­Ø°Ù</button>
          </div> <br/>
        `;
        container.appendChild(div);
      }
    });
  });
}



    function saveTeam(key) {
      const name = document.getElementById(`name-${key}`).value;
      const logo = document.getElementById(`logo-${key}`).value;
      const region = document.getElementById(`region-${key}`).value;
      const points = parseInt(document.getElementById(`points-${key}`).value) || 0;
      const status = document.getElementById(`status-${key}`).value;
      const rank = calculateRank(points);

      db.ref("teams/" + key).update({
        name, logo, region, points, status, rank, updatedAt: new Date().toISOString()
      }).then(() => {
        alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª");
      }).catch(err => {
        alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: " + err.message);
      });
    }

    function deleteTeam(key) {
      const teamRef = db.ref("teams/" + key);
      teamRef.once("value").then(snapshot => {
        const data = snapshot.val();
        if (data) {
          db.ref("rejected_teams").push(data).then(() => {
            teamRef.remove();
            alert("ğŸš« ØªÙ… Ù†Ù‚Ù„ Ø§Ù„ÙØ±ÙŠÙ‚ Ø¥Ù„Ù‰ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø±ÙÙˆØ¶ÙŠÙ†.");
          });
        }
      });
    }

    fetchTeams();
  </script>


  <script>
    

    // Ø¹Ø±Ø¶ Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
    db.ref("pending_teams").on("value", (snapshot) => {
      teamsDiv.innerHTML = "";
      snapshot.forEach((child) => {
        const team = child.val();
        const key = child.key;

        const div = document.createElement("div");
        div.className = "team-card";

        div.innerHTML = `
          <label>Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚: <input type="text" id="name-${key}" value="${team.name}"></label>
          <label>Ø±Ø§Ø¨Ø· Ø§Ù„Ø´Ø¹Ø§Ø±: <input type="text" id="logo-${key}" value="${team.logo}"></label>
          <label>Ø§Ù„Ø¥Ù‚Ù„ÙŠÙ…: <input type="text" id="region-${key}" value="${team.region}"></label>
          <label>Ø§Ù„Ù†Ù‚Ø§Ø·: <input type="number" id="points-${key}" value="${team.points}"></label>
          <label>Ø£Ø¶ÙŠÙ Ø¨ÙˆØ§Ø³Ø·Ø©: <input type="text" id="addedBy-${key}" value="${team.addedBy}"></label>
          <label>Ø­Ø§Ù„Ø© Ø§Ù„ÙØ±ÙŠÙ‚:
            <select id="status-${key}">
              <option value="">Ø§Ø®ØªØ± Ø­Ø§Ù„Ø©</option>
              <option value="Ù…ÙØªÙˆØ­">Ù…ÙØªÙˆØ­</option>
              <option value="Ù…ØºÙ„Ù‚">Ù…ØºÙ„Ù‚</option>
            </select>
          </label>
          <img src="${team.logo}" alt="Ø´Ø¹Ø§Ø± Ø§Ù„ÙØ±ÙŠÙ‚"><br>
          <button onclick="saveEdits('${key}')">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
          <button onclick="acceptTeam('${key}')">âœ… Ù‚Ø¨ÙˆÙ„</button>
          <button onclick="rejectTeam('${key}')">âŒ Ø±ÙØ¶</button>
        `;

        teamsDiv.appendChild(div);
      });
    });

    function saveEdits(key) {
      const points = parseInt(document.getElementById(`points-${key}`).value);
      let rank = "Ø¨Ø¯ÙˆÙ† ØªØµÙ†ÙŠÙ";
      if (points >= 800) rank = "Ø°Ù‡Ø¨ÙŠ";
      else if (points >= 500) rank = "ÙØ¶ÙŠ";
      else if (points >= 250) rank = "Ø¨Ø±ÙˆÙ†Ø²ÙŠ";

      const updatedData = {
        name: document.getElementById(`name-${key}`).value,
        logo: document.getElementById(`logo-${key}`).value,
        region: document.getElementById(`region-${key}`).value,
        points,
        rank,
        addedBy: document.getElementById(`addedBy-${key}`).value,
        status: document.getElementById(`status-${key}`).value,
        updatedAt: new Date().toISOString()
      };

      db.ref("pending_teams/" + key).update(updatedData)
        .then(() => alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØµÙ†ÙŠÙ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§."))
        .catch(err => alert("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ«: " + err.message));
    }

    function acceptTeam(key) {
      const teamRef = db.ref("pending_teams/" + key);
      teamRef.once("value").then(snapshot => {
        const team = snapshot.val();
        if (team) {
          db.ref("teams").push(team).then(() => {
            teamRef.remove();
            alert("âœ… ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„ÙØ±ÙŠÙ‚.");
          });
        }
      });
    }

    function rejectTeam(key) {
      const teamRef = db.ref("pending_teams/" + key);
      teamRef.once("value").then(snapshot => {
        const team = snapshot.val();
        if (team) {
          db.ref("rejected_teams").push(team).then(() => {
            teamRef.remove();
            alert("âŒ ØªÙ… Ø±ÙØ¶ Ø§Ù„ÙØ±ÙŠÙ‚.");
          });
        }
      });
    }

    // Ø¹Ø±Ø¶ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ
// Ø¹Ø±Ø¶ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ
db.ref("demonds/editTimesDemonds").on("value", (snapshot) => {
  requestsDiv.innerHTML = "";
  snapshot.forEach((child) => {
    const request = child.val();
    const key = child.key;

    const div = document.createElement("div");
    div.className = "edit-request-card";

    div.innerHTML = `
      <strong>Ù…Ù‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨:</strong> ${request.requestedBy || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}<br>
      <strong>Ø§Ù„ÙˆØµÙ:</strong><br>
      <textarea readonly rows="3">${request.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ'}</textarea><br>
      <small>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ${request.createdAt ? new Date(request.createdAt).toLocaleString() : '---'}</small><br>
      <button onclick="deleteRequest('${key}')">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨</button>
    `;

    requestsDiv.appendChild(div);
  });
});

// Ø¯Ø§Ù„Ø© Ø§Ù„Ø­Ø°Ù
function deleteRequest(key) {
  if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ")) {
    db.ref("demonds/editTimesDemonds").child(key).remove()
      .then(() => alert("ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­"))
      .catch((err) => alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù: " + err.message));
  }
}


  </script>
</body>
</html>
