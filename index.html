<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ÙØ±Ù‚</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f4f4f4;
    }
    h2 {
      color: #333;
    }
    .team-card, .edit-request-card {
      border: 2px solid #ccc;
      border-radius: 8px;
      background-color: #fff;
      padding: 15px;
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin: 8px 0 4px;
    }
    input, select, textarea {
      width: 100%;
      max-width: 400px;
      padding: 6px;
      margin-bottom: 10px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    button {
      margin: 5px 5px 0 0;
      padding: 8px 12px;
      border: none;
      border-radius: 4px;
      background-color: #f1c40f;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover {
      background-color: #e67e22;
    }
    img {
      margin-top: 10px;
      max-width: 120px;
    }
  </style>
</head>
<body>
  <h2>ğŸ“ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ù…Ø±Ø³Ù„Ø©</h2>
  <div id="teamsList"></div>

  <h2>ğŸ“© Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ</h2>
  <div id="editRequestsList"></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD5h5LAp9bVY9Xrx0yF8PaXih4841vSgBQ",
      authDomain: "workermanager999.firebaseapp.com",
      databaseURL: "https://workermanager999-default-rtdb.firebaseio.com",
      projectId: "workermanager999",
      storageBucket: "workermanager999.appspot.com",
      messagingSenderId: "961550697494",
      appId: "1:961550697494:web:4339c2bfc5c874496de137",
      measurementId: "G-99GTSST8VT"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const teamsDiv = document.getElementById("teamsList");
    const requestsDiv = document.getElementById("editRequestsList");

    // Ø¹Ø±Ø¶ Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
    db.ref("pending_teams").on("value", (snapshot) => {
      teamsDiv.innerHTML = "";
      snapshot.forEach((child) => {
        const team = child.val();
        const key = child.key;

        const div = document.createElement("div");
        div.className = "team-card";

        div.innerHTML = `
          <label>Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚: <input type="text" id="name-${key}" value="${team.name}"></label>
          <label>Ø±Ø§Ø¨Ø· Ø§Ù„Ø´Ø¹Ø§Ø±: <input type="text" id="logo-${key}" value="${team.logo}"></label>
          <label>Ø§Ù„Ø¥Ù‚Ù„ÙŠÙ…: <input type="text" id="region-${key}" value="${team.region}"></label>
          <label>Ø§Ù„Ù†Ù‚Ø§Ø·: <input type="number" id="points-${key}" value="${team.points}"></label>
          <label>Ø£Ø¶ÙŠÙ Ø¨ÙˆØ§Ø³Ø·Ø©: <input type="text" id="addedBy-${key}" value="${team.addedBy}"></label>
          <label>Ø­Ø§Ù„Ø© Ø§Ù„ÙØ±ÙŠÙ‚:
            <select id="status-${key}">
              <option value="">Ø§Ø®ØªØ± Ø­Ø§Ù„Ø©</option>
              <option value="Ù…ÙØªÙˆØ­">Ù…ÙØªÙˆØ­</option>
              <option value="Ù…ØºÙ„Ù‚">Ù…ØºÙ„Ù‚</option>
            </select>
          </label>
          <img src="${team.logo}" alt="Ø´Ø¹Ø§Ø± Ø§Ù„ÙØ±ÙŠÙ‚"><br>
          <button onclick="saveEdits('${key}')">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
          <button onclick="acceptTeam('${key}')">âœ… Ù‚Ø¨ÙˆÙ„</button>
          <button onclick="rejectTeam('${key}')">âŒ Ø±ÙØ¶</button>
        `;

        teamsDiv.appendChild(div);
      });
    });

    function saveEdits(key) {
      const points = parseInt(document.getElementById(`points-${key}`).value);
      let rank = "Ø¨Ø¯ÙˆÙ† ØªØµÙ†ÙŠÙ";
      if (points >= 800) rank = "Ø°Ù‡Ø¨ÙŠ";
      else if (points >= 500) rank = "ÙØ¶ÙŠ";
      else if (points >= 250) rank = "Ø¨Ø±ÙˆÙ†Ø²ÙŠ";

      const updatedData = {
        name: document.getElementById(`name-${key}`).value,
        logo: document.getElementById(`logo-${key}`).value,
        region: document.getElementById(`region-${key}`).value,
        points,
        rank,
        addedBy: document.getElementById(`addedBy-${key}`).value,
        status: document.getElementById(`status-${key}`).value,
        updatedAt: new Date().toISOString()
      };

      db.ref("pending_teams/" + key).update(updatedData)
        .then(() => alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØµÙ†ÙŠÙ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§."))
        .catch(err => alert("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ«: " + err.message));
    }

    function acceptTeam(key) {
      const teamRef = db.ref("pending_teams/" + key);
      teamRef.once("value").then(snapshot => {
        const team = snapshot.val();
        if (team) {
          db.ref("teams").push(team).then(() => {
            teamRef.remove();
            alert("âœ… ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„ÙØ±ÙŠÙ‚.");
          });
        }
      });
    }

    function rejectTeam(key) {
      const teamRef = db.ref("pending_teams/" + key);
      teamRef.once("value").then(snapshot => {
        const team = snapshot.val();
        if (team) {
          db.ref("rejected_teams").push(team).then(() => {
            teamRef.remove();
            alert("âŒ ØªÙ… Ø±ÙØ¶ Ø§Ù„ÙØ±ÙŠÙ‚.");
          });
        }
      });
    }

    // Ø¹Ø±Ø¶ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ
// Ø¹Ø±Ø¶ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ
db.ref("demonds/editTimesDemonds").on("value", (snapshot) => {
  requestsDiv.innerHTML = "";
  snapshot.forEach((child) => {
    const request = child.val();
    const key = child.key;

    const div = document.createElement("div");
    div.className = "edit-request-card";

    div.innerHTML = `
      <strong>Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ :</strong> ${request.teamKey || '---'}<br>
      <strong>Ù…Ù‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨:</strong> ${request.requestedBy || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}<br>
      <strong>Ø§Ù„ÙˆØµÙ:</strong><br>
      <textarea readonly rows="3">${request.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ'}</textarea><br>
      <small>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ${request.createdAt ? new Date(request.createdAt).toLocaleString() : '---'}</small>
    `;

    requestsDiv.appendChild(div);
  });
});

  </script>
</body>
</html>
